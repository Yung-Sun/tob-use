import{p as n}from"./app.fad36ee9.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const a={},p=n(`<h1 id="controlledref" tabindex="-1"><a class="header-anchor" href="#controlledref" aria-hidden="true">#</a> controlledRef</h1><p>\u53D7\u63A7\u578B ref</p><h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h2><h3 id="\u57FA\u7840" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840" aria-hidden="true">#</a> \u57FA\u7840</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> controlledRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/uni_modules/tob-use&#39;</span>

<span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">controlledRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doubled <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> num<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// \u539F\u751F\u884C\u4E3A</span>
num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">42</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 42</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doubled<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 84</span>

<span class="token comment">// \u8BBE\u7F6E\u503C\uFF0C\u4F46\u662F\u4E0D\u89E6\u53D1\u66F4\u65B0 (\u7B2C\u4E8C\u53C2\u6570\u8BBE\u7F6E\u4E3A false \u65F6)</span>
num<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 30</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doubled<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 84 (\u4ECD\u7136\u662F 84\uFF0C\u4E0D\u4F1A\u66F4\u65B0)</span>

<span class="token comment">// \u5077\u7AA5\uFF0C\u83B7\u53D6\u503C\uFF0C\u4F46\u4E0D track \u6536\u96C6\u526F\u4F5C\u7528</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 30</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 

<span class="token comment">// \u5373\u4F7F\u66F4\u65B0\u4E86\u4F9D\u8D56</span>
<span class="token comment">// \u4E5F\u4E0D\u4F1A trigger \u89E6\u53D1\u4E0A\u8FB9\u7684 watchEffect \u6CE8\u518C\u7684\u526F\u4F5C\u7528\u56DE\u8C03</span>
num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">50</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doubled<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 100</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><br><h3 id="\u9759\u9ED8" tabindex="-1"><a class="header-anchor" href="#\u9759\u9ED8" aria-hidden="true">#</a> \u9759\u9ED8</h3><p>\u6709\u65F6\u5019\u6211\u4EEC\u4E0D\u5E0C\u671B <code>getter</code> \u8BBF\u95EE\u65F6 <code>track</code> \u6536\u96C6\u526F\u4F5C\u7528\uFF0C\u6216 <code>setter</code> \u8BBE\u7F6E\u65F6 <code>trigger</code> \u89E6\u53D1\u526F\u4F5C\u7528\u3002</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> controlledRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/uni_modules/tob-use&#39;</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">controlledRef</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u9759\u9ED8\u8BBF\u95EE\uFF0C\u4EE5\u4E0B api \u7B49\u6548\uFF0C\u9009\u62E9\u5176\u4E00\u5373\u53EF</span>
foo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
foo<span class="token punctuation">.</span><span class="token function">untrackedGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
foo<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u9759\u9ED8\u8BBE\u7F6E\uFF0C\u4EE5\u4E0B api \u7B49\u6548\uFF0C\u9009\u62E9\u5176\u4E00\u5373\u53EF</span>
foo<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
foo<span class="token punctuation">.</span><span class="token function">silentSet</span><span class="token punctuation">(</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">)</span>
foo<span class="token punctuation">.</span><span class="token function">lay</span><span class="token punctuation">(</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><br><h3 id="\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a> \u914D\u7F6E</h3><h4 id="onbeforechange" tabindex="-1"><a class="header-anchor" href="#onbeforechange" aria-hidden="true">#</a> onBeforeChange</h4><p>\u914D\u7F6E <code>onBeforeChange</code> \u53EF\u4EE5\u5224\u65AD\u662F\u5426\u63A5\u53D7\u65B0\u503C</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> controlledRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/uni_modules/tob-use&#39;</span>

<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">controlledRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">onBeforeChange</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>value <span class="token operator">-</span> oldValue<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// \u8FD4\u56DE false \u65F6\uFF0C\u8BE5\u503C\u88AB\u5FFD\u7565</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 1</span>

num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">7</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 1 (\u65B0\u503C\u88AB\u5FFD\u7565\u4E86)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="onchanged" tabindex="-1"><a class="header-anchor" href="#onchanged" aria-hidden="true">#</a> onChanged</h4><p>\u7C7B\u4F3C\u539F\u751F\u7684 <code>watch</code>\uFF0C\u53EF\u4EE5\u76D1\u542C\u503C\u7684\u53D8\u66F4\u3002</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> controlledRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/uni_modules/tob-use&#39;</span>

<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">controlledRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">onChanged</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// \u6253\u5370 1</span>

num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// \u6253\u5370 2</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div>`,19);function e(t,o){return p}var u=s(a,[["render",e]]);export{u as default};
